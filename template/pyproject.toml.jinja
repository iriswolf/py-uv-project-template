[build-system]
requires = ["hatchling>=1.28"]
build-backend = "hatchling.build"

# src-layout
[tool.hatch.build.targets.wheel]
packages = ["src/{{ package_name }}"]

[tool.hatch.build.targets.sdist]
include = ["src", "tests", "README.md"]

###############
# Project
###############

[project]
name = "{{ project_name }}"
version = "{{ project_version }}"
description = "{{ project_description }}"
readme = "README.md"
requires-python = ">={{ minimal_python_version }}"
dependencies = []

[dependency-groups]
dev = [
    "pre-commit>=4.5.1",
    "ruff>=0.14.13",
    "mypy>=1.19.1",
    "line-profiler==5.0.0",
    { include-group = "test" },
]
test = [
    "pytest>=9.0.2",
    "pytest-asyncio>=1.3.0",
    "pytest-cov>=7.0.0",
    "pytest-html>=4.2.0",
    "pytest-mock>=3.15.1",
    "hypothesis>=6.150.2",
]

###############
# Tool settings
###############

[tool.mypy]
mypy_path = ["src"]
files = [
    "config",
    "scripts",
    "src",
    "tests",
]
# exclude = "^.*alembic.*$"
strict = true
pretty = true
follow_imports = "silent"
ignore_missing_imports = true
strict_optional = true
no_implicit_optional = true
warn_no_return = true
warn_unreachable = true
plugins = [
    # "pydantic.mypy",
    # "sqlalchemy.ext.mypy.plugin",
]

# [tool.pydantic-mypy]
# warn_required_dynamic_aliases = true
# warn_untyped_fields = true
# init_typed = true

[tool.pytest.ini_options]
testpaths = ["tests"]
markers = ["slow"]
addopts = "-m 'not slow'"
asyncio_mode = "auto"
asyncio_default_fixture_loop_scope = "function"
filterwarnings = []


[tool.ruff]
line-length = {{ project_line_length }}
#preview = true  # experimental

[tool.ruff.format]
quote-style = "double"
skip-magic-trailing-comma = false

[tool.ruff.lint]
select = [
    "A", # flake8-builtins            https://docs.astral.sh/ruff/rules/#flake8-builtins-a
    "ARG", # flake8-unused-arguments  https://docs.astral.sh/ruff/rules/#flake8-unused-arguments-arg
    "ASYNC", # flake8-async           https://docs.astral.sh/ruff/rules/#flake8-async-async
    "B", # flake8-bugbear             https://docs.astral.sh/ruff/rules/#flake8-bugbear-b
    "C4", # flake8-comprehensions     https://docs.astral.sh/ruff/rules/#flake8-comprehensions-c4
    "C90", # mccabe                   https://docs.astral.sh/ruff/rules/#mccabe-c90
    #    "COM", # flake8-commas            https://docs.astral.sh/ruff/rules/#flake8-commas-com
    # Incompatible with ruff formatter, but can be useful (uncomment once, then review changes)
    # See: https://github.com/astral-sh/ruff/issues/9216
    "DTZ", # flake8-datetimez         https://docs.astral.sh/ruff/rules/#flake8-datetimez-dtz
    "E", # pycodestyle-error          https://docs.astral.sh/ruff/rules/#error-e
    "ERA001", # commented-out-code    https://docs.astral.sh/ruff/rules/#eradicate-era
    "F", # pyflakes                   https://docs.astral.sh/ruff/rules/#pyflakes-f
    "FLY", # flynt                    https://docs.astral.sh/ruff/rules/#flynt-fly
    "I", # isort                      https://docs.astral.sh/ruff/rules/#isort-i
    "LOG", # flake8-logging           https://docs.astral.sh/ruff/rules/#flake8-logging-log
    "N", # pep8-naming                https://docs.astral.sh/ruff/rules/#pep8-naming-n
    "PERF", # Perflint                https://docs.astral.sh/ruff/rules/#perflint-perf
    "PL", # pylint                    https://docs.astral.sh/ruff/rules/#pylint-pl
    "PT", # flake8-pytest-style       https://docs.astral.sh/ruff/rules/#flake8-pytest-style-pt
    "PTH", # flake8-use-pathlib       https://docs.astral.sh/ruff/rules/#flake8-use-pathlib-pth
    "Q", # flake8-quotes              https://docs.astral.sh/ruff/rules/#flake8-quotes-q
    "RET", # flake8-return (RET)      https://docs.astral.sh/ruff/rules/#flake8-return-ret
    "RSE", # flake8-raise (RSE)       https://docs.astral.sh/ruff/rules/#flake8-raise-rse
    "RUF", # Ruff-specific rules      https://docs.astral.sh/ruff/rules/#ruff-specific-rules-ruf
    "S", # flake8-bandit              https://docs.astral.sh/ruff/rules/#flake8-bandit-s
    "SIM", # flake8-simplify          https://docs.astral.sh/ruff/rules/#flake8-simplify-sim
    "SLF", # flake8-self (SLF)        https://docs.astral.sh/ruff/rules/#flake8-self-slf
    "SLOT", # flake8-slots            https://docs.astral.sh/ruff/rules/#flake8-slots-slot
    "T20", # flake8-print             https://docs.astral.sh/ruff/rules/#flake8-print-t20
    "TCH", # flake8-type-checking     https://docs.astral.sh/ruff/rules/#flake8-type-checking-tch
    "TID", # flake8-tidy-imports      https://docs.astral.sh/ruff/rules/#flake8-tidy-imports-tid
    "UP", # pyupgrade                 https://docs.astral.sh/ruff/rules/#pyupgrade-up
    "W", # pycodestyle-warning        https://docs.astral.sh/ruff/rules/#warning-w
]
ignore = [
    "N818", # error-suffix-on-exception-name
    "PLR0913", # too-many-arguments
    "PLR0917", # too-many-positional-arguments
    "PLR6301", # no-self-use
    "PTH123", # builtin-open
    "TC001", # typing-only-first-party-import
    "TC002", # typing-only-third-party-import
    "TC003", # typing-only-standard-library-import
    "TC006", # runtime-cast-value
    "UP015", # redundant-open-modes
]
# Что будет исправлено при аргументе --fix
fixable = ["ALL"]

[tool.ruff.lint.per-file-ignores]
# "src/app/infrastructure/persistence_sqla/alembic/**" = ["ALL"]
"tests/**" = [
    "ARG002", # unused-method-argument
    "PLC2801", # unnecessary-dunder-call
    "PLR2004", # magic-value-comparison
    "PT011", # pytest-raises-too-broad
    "S101", # assert
    "S106", # hardcoded-password-func-arg
    "S107", # hardcoded-password-default
]

[tool.slotscheck]
strict-imports = true
#exclude-modules = '''
#^app\.infrastructure\.persistence_sqla\.alembic
#'''
